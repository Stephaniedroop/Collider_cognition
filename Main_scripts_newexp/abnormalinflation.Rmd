---
title: "modelcheckplot"
output: html_document
date: "2025-01-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggnewscale)
library(tidyverse)
```


Above here was a holdover from old script - if you want it back, go to the equivalent in cogsci_25 or collider folder, or scripts_oldexp

## Check for significance and abnormal inflation

Test for significance

Get trialtypes d7 and c5 (111), for pgroups 1 and 3, for individual observations, and tag with whether or not they selected the lower-probability variable 

```{r, include=FALSE}
load('../Data/Data.Rdata', verbose = T) # This is one big df2, 2580 of 14

data <- df2 %>% 
  unite('pg_tt', pgroup, trialtype, sep = "_", remove = FALSE)

```


```{r, include=FALSE}
dfab <- data %>% # 92 obs of 15
  filter(pgroup %in% c(1, 3),
         trialtype %in% c('c5', 'd7'),
         node3 %in% c('A=1', 'B=1'))

# Variable P: allocate 1 when they choose the more normal variable (same in both pgroup 1 and 3)
dfab <- dfab %>% 
  mutate(P = case_when(
    node3 == 'B=1' ~ 1,
    node3 == 'A=1' ~ 0
  ))

dfab <- dfab %>% 
  select(subject_id, pg_tt, P) 

```


And for an lme4 significance test: exponentiate the Estimate to odds ratios. 
Only the coefficients/estimates on the link function scale—not standard errors, p-values, or z-values—should be exponentiated unless you're transforming confidence intervals.

```{r, include=FALSE}
#library(lme4)
library(lmerTest)

predP <- glmer(P ~ 1 + (1|subject_id) + (1|pg_tt), data = dfab, family = binomial(link='logit'))
summary(predP)

est <- exp(fixef(predP))

coef <- fixef(predP)

lower_logodds <- coef-(1.96*.3387)
upper_logodds <- coef+(1.96*.3387)

lower_or <- exp(lower_logodds)
upper_or <- exp(upper_logodds)

```

Does this now need transformed? How?